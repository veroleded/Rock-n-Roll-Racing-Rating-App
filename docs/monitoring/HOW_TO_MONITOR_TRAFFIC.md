# –ö–∞–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ, –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:

### 1. –†–∞–∑–æ–≤—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)

```bash
./monitor-traffic.sh
```

–ü–æ–∫–∞–∂–µ—Ç:

- üì§ –ò—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 2.5 GB)
- üì• –í—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫
- üî¥ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫ Redis
- ü§ñ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π Discord
- ‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö

### 2. –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–¥–ª—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏)

```bash
./monitor-traffic-continuous.sh
```

–ë—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:

- –¢–µ–∫—É—â–∏–π —Ç—Ä–∞—Ñ–∏–∫
- –°–∫–æ—Ä–æ—Å—Ç—å —Ç—Ä–∞—Ñ–∏–∫–∞ (–±–∞–π—Ç/—Å–µ–∫)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

–ù–∞–∂–º–∏—Ç–µ `Ctrl+C` –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏.

### 3. –ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

```
http://localhost:3000/api/metrics
```

–ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:

- `network_bytes_out_total` - –æ–±—â–∏–π –∏—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –≤ –±–∞–π—Ç–∞—Ö
- `network_bytes_in_total` - –æ–±—â–∏–π –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –≤ –±–∞–π—Ç–∞—Ö

**–ü—Ä–∏–º–µ—Ä:**

```
network_bytes_out_total 4611686018427387904
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç ~4 GB –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞.

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –≤—ã—Å–æ–∫–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞?

### –ï—Å–ª–∏ —Ç—Ä–∞—Ñ–∏–∫ > 1 GB:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–ø–∏—Å–∫–∏ Redis:**

   ```bash
   ./monitor-traffic.sh | grep "Redis"
   ```

   - –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–æ–∫ –±–æ–ª—å—à–µ 5 ‚Üí –≤–æ–∑–º–æ–∂–Ω–∞ —É—Ç–µ—á–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫
   - –ù–æ—Ä–º–∞–ª—å–Ω–æ: 1-2 –ø–æ–¥–ø–∏—Å–∫–∏

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Discord:**

   ```bash
   ./monitor-traffic.sh | grep "Discord"
   ```

   - –ï—Å–ª–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –±–æ–ª—å—à–µ 10 ‚Üí –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º
   - –ù–æ—Ä–º–∞–ª—å–Ω–æ: 0-2 –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

3. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**

   ```bash
   docker-compose -f docker-compose.local.yml down
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   docker-compose -f docker-compose.local.yml logs --tail=100 | grep -i "error\|warning\|traffic"
   ```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

```bash
watch -n 300 ./monitor-traffic.sh
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å –∑–∞–ø–∏—Å—å—é –≤ —Ñ–∞–π–ª

```bash
./monitor-traffic-continuous.sh > traffic.log 2>&1
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

```bash
./monitor-traffic.sh http://your-server:3000/api/metrics
```

## –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

- –ò—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫: < 100 MB/—á–∞—Å (–¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
- –ü–æ–¥–ø–∏—Å–∫–∏ Redis: 1-2
- –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Discord: 0-2

### –¢—Ä–µ–≤–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

- –ò—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫: > 1 GB/—á–∞—Å
- –ü–æ–¥–ø–∏—Å–∫–∏ Redis: > 5
- –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Discord: > 10

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è:

- –ò—Å—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫: > 10 GB/—á–∞—Å
- –ü–æ–¥–ø–∏—Å–∫–∏ Redis: > 20
- –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Discord: > 50

–ü—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏!

## –ò—Å—Ç–æ—Ä–∏—è –º–µ—Ç—Ä–∏–∫

–ú–µ—Ç—Ä–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç. –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é:

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π
./view-metrics-history.sh

# –ü—Ä–æ—Å–º–æ—Ç—Ä —á–µ—Ä–µ–∑ API
curl http://localhost:3000/api/metrics/history?limit=20

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥
curl http://localhost:3000/api/metrics/history?stats=true
```

### –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –º–µ—Ç—Ä–∏–∫–∏

- **–§–∞–π–ª:** `logs/metrics/metrics.jsonl`
- **–§–æ—Ä–º–∞—Ç:** JSON Lines (–∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ - –æ—Ç–¥–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å)
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:** –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:** –¢—Ä–∞—Ñ–∏–∫, –ø–æ–¥–ø–∏—Å–∫–∏ Redis, –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Discord, –ø–æ–ª–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Prometheus

### –ü—Ä—è–º–æ–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–∞–π–ª–∞

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∑–∞–ø–∏—Å–µ–π
tail -n 10 logs/metrics/metrics.jsonl | jq '.'

# –ü–æ–∏—Å–∫ –∑–∞–ø–∏—Å–µ–π —Å –≤—ã—Å–æ–∫–∏–º —Ç—Ä–∞—Ñ–∏–∫–æ–º
cat logs/metrics/metrics.jsonl | jq 'select(.networkBytesOut > 1073741824)'
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –º–µ—Ç—Ä–∏–∫–∞—Ö —Å–º. [METRICS_USAGE.md](./METRICS_USAGE.md)
